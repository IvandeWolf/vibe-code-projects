<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Meal Planner</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #cbf3f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            color: #333;
        }
        
        h1, h2, h3 {
            color: #444;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #ffbf69;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
            color: #333;
            transition: all 0.2s ease;
        }
        
        .tab:hover {
            background-color: #ffd699;
        }
        
        .tab.active {
            background-color: #ffffff;
            border-bottom: 2px solid #ffffff;
            margin-bottom: -1px;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .week-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 768px) {
            .week-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1200px) {
            .week-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .day-card {
            background-color: #ffffff;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #cbf3f0;
        }
        
        .day-title {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
            color: #555;
        }
        
        .meal-selector {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            background-color: #fff;
            font-size: 14px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        .meal-selector:focus {
            border-color: #2ec4b6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 196, 182, 0.2);
        }
        
        .people-counter {
            display: flex;
            align-items: center;
            margin-top: 10px;
            justify-content: center;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        
        .people-counter label {
            margin: 0 10px 0 0;
            font-size: 14px;
            font-weight: normal;
        }
        
        .counter-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2ec4b6;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .counter-btn:hover {
            background-color: #28b0a3;
        }
        
        .counter-value {
            width: 30px;
            text-align: center;
            font-weight: bold;
            margin: 0 5px;
        }
        
        button {
            background-color: #2ec4b6;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }
        
        button:hover {
            background-color: #28b0a3;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .randomize-btn {
            padding: 12px 20px;
            font-size: 16px;
        }
        
        .clear-btn {
            background-color: #ff9f1c;
            padding: 12px 20px;
            font-size: 16px;
        }
        
        .clear-btn:hover {
            background-color: #e89018;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }
        
        .meal-list {
            max-height: 600px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .meal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #cbf3f0;
        }
        
        .meal-item:hover {
            background-color: #f5f5f5;
        }
        
        .meal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .meal-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 15px;
            transition: all 0.3s ease;
            border: 1px solid #cbf3f0;
        }
        
        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #2ec4b6;
        }
        
        .meal-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }
        
        .meal-card p {
            color: #666;
            margin-bottom: 15px;
        }
        
        .meal-card .ingredients-list {
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .meal-card .serving-info {
            background-color: #f9f9f9;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 10px;
            color: #666;
        }
        
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .edit-btn {
            background-color: #2ec4b6;
        }
        
        .edit-btn:hover {
            background-color: #28b0a3;
        }
        
        .save-btn {
            background-color: #2ec4b6;
        }
        
        .save-btn:hover {
            background-color: #28b0a3;
        }
        
        .cancel-btn {
            background-color: #9e9e9e;
        }
        
        .cancel-btn:hover {
            background-color: #8e8e8e;
        }
        
        .delete-btn {
            background-color: #ff9f1c;
        }
        
        .delete-btn:hover {
            background-color: #e89018;
        }
        
        .add-ingredient-btn {
            margin-top: 10px;
            background-color: #ffbf69;
            color: #333;
        }
        
        .add-ingredient-btn:hover {
            background-color: #f5b55f;
        }
        
        .category-group {
            margin-bottom: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .category-title {
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #cbf3f0;
            color: #2ec4b6;
        }
        
        /* Enhanced input styles */
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.3s;
            background-color: #f9f9f9;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2ec4b6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 196, 182, 0.2);
            background-color: #fff;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .ingredient-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
            gap: 10px;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .ingredient-row:hover {
            background-color: #f0f0f0;
        }
        
        .ingredient-row select, .ingredient-row input {
            margin-right: 0;
            flex: 1;
        }
        
        .ingredient-amount {
            width: 100px !important;
            flex: 0 0 100px;
        }
        
        .ingredient-unit {
            width: 80px !important;
            flex: 0 0 80px;
        }
        
        .ingredient-row button {
            padding: 8px;
            flex: 0 0 auto;
        }
        
        .ingredients-container {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .meal-form, .category-form, .ingredient-form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
        }
        
        /* Ingredient management tab */
        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .ingredient-card {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #cbf3f0;
            transition: all 0.3s;
        }
        
        .ingredient-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-color: #2ec4b6;
        }
        
        .ingredient-card h4 {
            margin-top: 0;
            margin-bottom: 8px;
            color: #333;
        }
        
        .ingredient-info {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .ingredient-category {
            background-color: #ffbf69;
            color: #333;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .serving-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .serving-input-group label {
            margin-bottom: 0;
            margin-right: 10px;
            flex: 0 0 auto;
        }
        
        .serving-input-group input {
            width: 70px;
            flex: 0 0 70px;
            margin-right: 10px;
        }
        
        .search-box {
            padding: 12px;
            border-radius: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            margin-bottom: 20px;
            width: 100%;
            font-size: 14px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>');
            background-repeat: no-repeat;
            background-position: 10px center;
            background-size: 16px 16px;
            padding-left: 35px;
        }
        
        .search-box:focus {
            border-color: #2ec4b6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 196, 182, 0.2);
            background-color: #fff;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .badge-primary {
            background-color: #2ec4b6;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Weekly Meal Planner</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="meal-plan">Weekly Plan</div>
        <div class="tab" data-tab="meal-list">Meal List</div>
        <div class="tab" data-tab="ingredients">Ingredients</div>
        <div class="tab" data-tab="shopping-list">Shopping List</div>
        <div class="tab" data-tab="manage-categories">Categories</div>
    </div>
    
    <div class="tab-content active" id="meal-plan">
        <div class="container">
            <h2>This Week's Dinner Plan</h2>
            <div class="week-grid" id="week-grid">
                <!-- Day cards will be dynamically generated -->
            </div>
            <div class="button-group">
                <button class="clear-btn" id="clear-week-btn">Clear All Selections</button>
                <button class="randomize-btn" id="randomize-btn">Randomly Plan My Week</button>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="meal-list">
        <div class="container">
            <h2>All Meals</h2>
            <div class="meal-form">
                <h3>Add New Meal</h3>
                <div class="form-group">
                    <label for="meal-name">Meal Name:</label>
                    <input type="text" id="meal-name" placeholder="Enter meal name">
                </div>
                <div class="form-group">
                    <label for="meal-description">Description (optional):</label>
                    <textarea id="meal-description" placeholder="Enter meal description or notes"></textarea>
                </div>
                <div class="serving-input-group">
                    <label for="meal-servings">Recipe serves:</label>
                    <input type="number" id="meal-servings" min="1" value="4">
                    <span>people</span>
                </div>
                <div class="form-group">
                    <label>Ingredients:</label>
                    <div class="ingredients-container" id="ingredients-container">
                        <!-- Ingredient rows will be added here -->
                    </div>
                    <button class="add-ingredient-btn" id="add-ingredient-btn">Add Ingredient</button>
                </div>
                <button id="add-meal-btn">Add Meal</button>
            </div>
            
            <div class="meal-list" id="meals-container">
                <!-- Meals will be listed here -->
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="shopping-list">
        <div class="container">
            <h2>Shopping List for the Week</h2>
            <div class="shopping-list" id="shopping-list-container">
                <!-- Shopping list will be generated here -->
            </div>
            <button id="print-shopping-list">Print Shopping List</button>
        </div>
    </div>
    
    <div class="tab-content" id="manage-categories">
        <div class="container">
            <h2>Manage Ingredient Categories</h2>
            <div class="category-form">
                <h3>Add New Category</h3>
                <div class="form-group">
                    <label for="category-name">Category Name:</label>
                    <input type="text" id="category-name" placeholder="Enter category name">
                </div>
                <button id="add-category-btn">Add Category</button>
            </div>
            
            <div id="categories-list">
                <!-- Categories will be listed here -->
            </div>
        </div>
    </div>

    <div class="tab-content" id="ingredients">
        <div class="container">
            <h2>Manage Ingredients</h2>
            <input type="text" class="search-box" id="ingredient-search" placeholder="Search for ingredients...">
            
            <div class="ingredient-form">
                <h3>Add New Ingredient</h3>
                <div class="form-group">
                    <label for="ingredient-name">Ingredient Name:</label>
                    <input type="text" id="ingredient-name" placeholder="Enter ingredient name">
                </div>
                <div class="form-group">
                    <label for="ingredient-category-select">Category:</label>
                    <select id="ingredient-category-select">
                        <!-- Categories will be dynamically added -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="ingredient-default-unit">Default Unit:</label>
                    <select id="ingredient-default-unit">
                        <option value="g">Grams (g)</option>
                        <option value="kg">Kilograms (kg)</option>
                        <option value="ml">Milliliters (ml)</option>
                        <option value="l">Liters (l)</option>
                        <option value="tsp">Teaspoon (tsp)</option>
                        <option value="tbsp">Tablespoon (tbsp)</option>
                        <option value="cup">Cup</option>
                        <option value="pcs">Pieces</option>
                        <option value="pinch">Pinch</option>
                        <option value="slice">Slice</option>
                        <option value="clove">Clove</option>
                        <option value="bunch">Bunch</option>
                        <option value="can">Can</option>
                        <option value="package">Package</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <button id="add-ingredient-btn-standalone">Add Ingredient</button>
            </div>
            
            <div class="ingredients-grid" id="ingredients-grid">
                <!-- Ingredients will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Data structure
        let meals = [];
        let categories = [];
        let ingredients = []; // New array for standalone ingredients
        let weeklyPlan = {
            Monday: { type: 'meal', mealId: null, people: 2 },
            Tuesday: { type: 'meal', mealId: null, people: 2 },
            Wednesday: { type: 'meal', mealId: null, people: 2 },
            Thursday: { type: 'meal', mealId: null, people: 2 },
            Friday: { type: 'meal', mealId: null, people: 2 },
            Saturday: { type: 'meal', mealId: null, people: 2 },
            Sunday: { type: 'meal', mealId: null, people: 2 }
        };
        
        // Load data from localStorage
        function loadData() {
            if (localStorage.getItem('mealPlannerMeals')) {
                meals = JSON.parse(localStorage.getItem('mealPlannerMeals'));
            }
            
            if (localStorage.getItem('mealPlannerCategories')) {
                categories = JSON.parse(localStorage.getItem('mealPlannerCategories'));
            } else {
                // Initialize with some default categories
                categories = [
                    { id: 1, name: 'Fruits & Vegetables' },
                    { id: 2, name: 'Meat & Fish' },
                    { id: 3, name: 'Dairy & Eggs' },
                    { id: 4, name: 'Grains & Pasta' },
                    { id: 5, name: 'Canned Goods' },
                    { id: 6, name: 'Spices & Condiments' },
                    { id: 7, name: 'Other' }
                ];
                saveData();
            }
            
            if (localStorage.getItem('mealPlannerIngredients')) {
                ingredients = JSON.parse(localStorage.getItem('mealPlannerIngredients'));
            }
            
            if (localStorage.getItem('mealPlannerWeeklyPlan')) {
                weeklyPlan = JSON.parse(localStorage.getItem('mealPlannerWeeklyPlan'));
                
                // Ensure people count exists for backward compatibility
                for (const day in weeklyPlan) {
                    if (!weeklyPlan[day].hasOwnProperty('people')) {
                        weeklyPlan[day].people = 2;
                    }
                }
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('mealPlannerMeals', JSON.stringify(meals));
            localStorage.setItem('mealPlannerCategories', JSON.stringify(categories));
            localStorage.setItem('mealPlannerIngredients', JSON.stringify(ingredients));
            localStorage.setItem('mealPlannerWeeklyPlan', JSON.stringify(weeklyPlan));
        }
        
        // Tab functionality
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and tab contents
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    const tabContentId = tab.getAttribute('data-tab');
                    document.getElementById(tabContentId).classList.add('active');
                });
            });
        }
        
        // Generate weekly plan grid
        function generateWeekGrid() {
            const weekGrid = document.getElementById('week-grid');
            weekGrid.innerHTML = '';
            
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            days.forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                const dayTitle = document.createElement('h3');
                dayTitle.className = 'day-title';
                dayTitle.textContent = day;
                
                const mealSelector = document.createElement('select');
                mealSelector.className = 'meal-selector';
                mealSelector.id = `${day.toLowerCase()}-selector`;
                
                // Add the "Other" option first
                const otherOption = document.createElement('option');
                otherOption.value = 'other';
                otherOption.textContent = 'Other (Eating Out)';
                mealSelector.appendChild(otherOption);
                
                // Add option for no selection
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = '-- Select a meal --';
                mealSelector.appendChild(emptyOption);
                
                // Add meal options
                meals.forEach(meal => {
                    const option = document.createElement('option');
                    option.value = meal.id;
                    option.textContent = meal.name;
                    mealSelector.appendChild(option);
                });
                
                // Set selected value based on weekly plan
                if (weeklyPlan[day].type === 'other') {
                    mealSelector.value = 'other';
                } else if (weeklyPlan[day].mealId !== null) {
                    mealSelector.value = weeklyPlan[day].mealId;
                } else {
                    mealSelector.value = '';
                }
                
                // Add event listener for selection change
                mealSelector.addEventListener('change', (e) => {
                    if (e.target.value === 'other') {
                        weeklyPlan[day] = { type: 'other', mealId: null, people: weeklyPlan[day].people };
                    } else if (e.target.value === '') {
                        weeklyPlan[day] = { type: 'meal', mealId: null, people: weeklyPlan[day].people };
                    } else {
                        weeklyPlan[day] = { type: 'meal', mealId: e.target.value, people: weeklyPlan[day].people };
                    }
                    saveData();
                    generateShoppingList();
                });
                
                // People counter
                const peopleCounter = document.createElement('div');
                peopleCounter.className = 'people-counter';
                
                const peopleLabel = document.createElement('label');
                peopleLabel.textContent = 'People:';
                
                const counterValue = document.createElement('span');
                counterValue.className = 'counter-value';
                counterValue.textContent = weeklyPlan[day].people;
                
                const incrementBtn = document.createElement('button');
                incrementBtn.className = 'counter-btn';
                incrementBtn.textContent = '+';
                incrementBtn.addEventListener('click', () => {
                    weeklyPlan[day].people++;
                    counterValue.textContent = weeklyPlan[day].people;
                    saveData();
                });
                
                const decrementBtn = document.createElement('button');
                decrementBtn.className = 'counter-btn';
                decrementBtn.textContent = '-';
                decrementBtn.addEventListener('click', () => {
                    if (weeklyPlan[day].people > 1) {
                        weeklyPlan[day].people--;
                        counterValue.textContent = weeklyPlan[day].people;
                        saveData();
                    }
                });
                
                peopleCounter.appendChild(peopleLabel);
                peopleCounter.appendChild(decrementBtn);
                peopleCounter.appendChild(counterValue);
                peopleCounter.appendChild(incrementBtn);
                
                dayCard.appendChild(dayTitle);
                dayCard.appendChild(mealSelector);
                dayCard.appendChild(peopleCounter);
                weekGrid.appendChild(dayCard);
            });
        }
        
        // Generate meal list
        function generateMealList() {
            const mealsContainer = document.getElementById('meals-container');
            mealsContainer.innerHTML = '';
            
            if (meals.length === 0) {
                mealsContainer.innerHTML = '<p>No meals added yet. Add your first meal above!</p>';
                return;
            }
            
            meals.forEach(meal => {
                const mealItem = document.createElement('div');
                mealItem.className = 'meal-item';
                
                const mealInfo = document.createElement('div');
                mealInfo.className = 'meal-info';
                
                const mealName = document.createElement('h3');
                mealName.textContent = meal.name;
                mealInfo.appendChild(mealName);
                
                if (meal.description) {
                    const mealDesc = document.createElement('p');
                    mealDesc.textContent = meal.description;
                    mealInfo.appendChild(mealDesc);
                }
                
                if (meal.ingredients && meal.ingredients.length > 0) {
                    const ingredientsList = document.createElement('div');
                    ingredientsList.className = 'ingredients-list';
                    ingredientsList.innerHTML = '<strong>Ingredients:</strong> ';
                    
                    const ingredientTexts = meal.ingredients.map(ing => {
                        const category = categories.find(cat => cat.id == ing.categoryId);
                        return `${ing.name} (${category ? category.name : 'Uncategorized'})`;
                    });
                    
                    ingredientsList.innerHTML += ingredientTexts.join(', ');
                    mealInfo.appendChild(ingredientsList);
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => {
                    deleteMeal(meal.id);
                });
                
                mealItem.appendChild(mealInfo);
                mealItem.appendChild(deleteBtn);
                mealsContainer.appendChild(mealItem);
            });
        }
        
        // Delete meal
        function deleteMeal(mealId) {
            if (confirm('Are you sure you want to delete this meal?')) {
                meals = meals.filter(meal => meal.id != mealId);
                
                // Also remove it from weekly plan if it's selected
                for (const day in weeklyPlan) {
                    if (weeklyPlan[day].mealId == mealId) {
                        weeklyPlan[day].mealId = null;
                    }
                }
                
                saveData();
                generateMealList();
                generateWeekGrid();
                generateShoppingList();
            }
        }
        
        // Add a new meal
        function setupMealForm() {
            const addMealBtn = document.getElementById('add-meal-btn');
            const addIngredientBtn = document.getElementById('add-ingredient-btn');
            const ingredientsContainer = document.getElementById('ingredients-container');
            
            // Add ingredient row
            function addIngredientRow(ingredientData = null) {
                const row = document.createElement('div');
                row.className = 'ingredient-row';
                
                // Create ingredient selector that uses our ingredients list
                const ingredientSelect = document.createElement('select');
                ingredientSelect.className = 'ingredient-select';
                
                // Add empty option
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = '-- Select ingredient --';
                ingredientSelect.appendChild(emptyOption);
                
                // Add all ingredients from our ingredients list
                ingredients.forEach(ing => {
                    const option = document.createElement('option');
                    option.value = ing.id;
                    option.textContent = ing.name;
                    // Set data attributes for category and unit
                    option.dataset.categoryId = ing.categoryId;
                    option.dataset.unit = ing.unit;
                    ingredientSelect.appendChild(option);
                });
                
                // Amount input
                const amountInput = document.createElement('input');
                amountInput.type = 'number';
                amountInput.min = '0.1';
                amountInput.step = '0.1';
                amountInput.className = 'ingredient-amount';
                amountInput.placeholder = 'Amount';
                amountInput.value = ingredientData && ingredientData.amount ? ingredientData.amount : '';
                
                // Unit display (will be filled based on ingredient selection)
                const unitDisplay = document.createElement('input');
                unitDisplay.type = 'text';
                unitDisplay.className = 'ingredient-unit';
                unitDisplay.readOnly = true;
                unitDisplay.placeholder = 'Unit';
                unitDisplay.value = ingredientData && ingredientData.unit ? ingredientData.unit : '';
                
                // Set initial values if we have ingredient data
                if (ingredientData && ingredientData.ingredientId) {
                    ingredientSelect.value = ingredientData.ingredientId;
                    
                    // Set unit from the selected ingredient
                    const selectedOption = ingredientSelect.options[ingredientSelect.selectedIndex];
                    if (selectedOption) {
                        unitDisplay.value = selectedOption.dataset.unit || '';
                    }
                }
                
                // Update unit when ingredient changes
                ingredientSelect.addEventListener('change', () => {
                    if (ingredientSelect.value) {
                        const selectedOption = ingredientSelect.options[ingredientSelect.selectedIndex];
                        if (selectedOption) {
                            unitDisplay.value = selectedOption.dataset.unit || '';
                        }
                    } else {
                        unitDisplay.value = '';
                    }
                });
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'delete-btn';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', () => {
                    row.remove();
                });
                
                row.appendChild(ingredientSelect);
                row.appendChild(amountInput);
                row.appendChild(unitDisplay);
                row.appendChild(removeBtn);
                
                ingredientsContainer.appendChild(row);
            }
            
            // Add ingredient button event
            addIngredientBtn.addEventListener('click', () => {
                addIngredientRow();
            });
            
            // Add meal button event
            addMealBtn.addEventListener('click', () => {
                const nameInput = document.getElementById('meal-name');
                const descInput = document.getElementById('meal-description');
                const servingsInput = document.getElementById('meal-servings');
                
                if (!nameInput.value.trim()) {
                    alert('Please enter a meal name');
                    return;
                }
                
                if (!servingsInput.value || servingsInput.value < 1) {
                    alert('Please enter a valid number of servings');
                    return;
                }
                
                // Collect ingredients
                const recipeIngredients = [];
                const ingredientRows = document.querySelectorAll('.ingredient-row');
                
                ingredientRows.forEach(row => {
                    const ingredientSelect = row.querySelector('.ingredient-select');
                    const amountInput = row.querySelector('.ingredient-amount');
                    const unitDisplay = row.querySelector('.ingredient-unit');
                    
                    if (ingredientSelect.value) {
                        const selectedOption = ingredientSelect.options[ingredientSelect.selectedIndex];
                        
                        recipeIngredients.push({
                            ingredientId: ingredientSelect.value,
                            name: selectedOption.textContent,
                            categoryId: selectedOption.dataset.categoryId,
                            amount: amountInput.value || '1',
                            unit: unitDisplay.value || ''
                        });
                    }
                });
                
                // Create new meal object
                const newMeal = {
                    id: Date.now().toString(),
                    name: nameInput.value.trim(),
                    description: descInput.value.trim(),
                    servings: parseInt(servingsInput.value) || 4,
                    ingredients: recipeIngredients
                };
                
                // Add to meals array
                meals.push(newMeal);
                saveData();
                
                // Clear form
                nameInput.value = '';
                descInput.value = '';
                servingsInput.value = '4';
                ingredientsContainer.innerHTML = '';
                
                // Refresh UI
                generateMealGrid();
                generateWeekGrid();
                
                // Add initial ingredient row
                addIngredientRow();
            });
            
            // Add initial ingredient row
            addIngredientRow();
        }
        
        // Category management
        function setupCategoryManagement() {
            const addCategoryBtn = document.getElementById('add-category-btn');
            const categoryInput = document.getElementById('category-name');
            const categoriesList = document.getElementById('categories-list');
            
            function updateCategoriesList() {
                categoriesList.innerHTML = '';
                
                if (categories.length === 0) {
                    categoriesList.innerHTML = '<p>No categories defined yet.</p>';
                    return;
                }
                
                categories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'meal-item';
                    categoryItem.id = `category-${category.id}`;
                    
                    const categoryName = document.createElement('div');
                    categoryName.textContent = category.name;
                    
                    const actionButtons = document.createElement('div');
                    actionButtons.className = 'action-buttons';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'edit-btn';
                    editBtn.textContent = 'Edit';
                    editBtn.addEventListener('click', () => {
                        editCategory(category.id);
                    });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', () => {
                        // Check if category is in use
                        let inUse = false;
                        meals.forEach(meal => {
                            if (meal.ingredients && meal.ingredients.some(ing => ing.categoryId == category.id)) {
                                inUse = true;
                            }
                        });
                        
                        if (inUse) {
                            alert('This category is being used by ingredients in your meals. Please update those meals first.');
                            return;
                        }
                        
                        if (confirm('Are you sure you want to delete this category?')) {
                            categories = categories.filter(cat => cat.id != category.id);
                            saveData();
                            updateCategoriesList();
                        }
                    });
                    
                    actionButtons.appendChild(editBtn);
                    actionButtons.appendChild(deleteBtn);
                    
                    categoryItem.appendChild(categoryName);
                    categoryItem.appendChild(actionButtons);
                    categoriesList.appendChild(categoryItem);
                });
            }
            
            function editCategory(categoryId) {
                const category = categories.find(c => c.id == categoryId);
                if (!category) return;
                
                const categoryItem = document.getElementById(`category-${categoryId}`);
                if (!categoryItem) return;
                
                // Save original content
                const originalContent = categoryItem.innerHTML;
                
                // Clear the item and add edit form
                categoryItem.innerHTML = '';
                
                const form = document.createElement('div');
                form.className = 'category-edit-form';
                form.style.display = 'flex';
                form.style.alignItems = 'center';
                form.style.gap = '10px';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = category.name;
                nameInput.style.flex = '1';
                
                const saveBtn = document.createElement('button');
                saveBtn.className = 'save-btn';
                saveBtn.textContent = 'Save';
                saveBtn.addEventListener('click', () => {
                    if (!nameInput.value.trim()) {
                        alert('Please enter a category name');
                        return;
                    }
                    
                    category.name = nameInput.value.trim();
                    saveData();
                    updateCategoriesList();
                    setupMealForm(); // Refresh ingredient selects
                });
                
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = 'Cancel';
                cancelBtn.addEventListener('click', () => {
                    categoryItem.innerHTML = originalContent;
                });
                
                form.appendChild(nameInput);
                form.appendChild(saveBtn);
                form.appendChild(cancelBtn);
                
                categoryItem.appendChild(form);
            }
            
            addCategoryBtn.addEventListener('click', () => {
                if (!categoryInput.value.trim()) {
                    alert('Please enter a category name');
                    return;
                }
                
                // Create new category
                const newCategory = {
                    id: Date.now().toString(),
                    name: categoryInput.value.trim()
                };
                
                categories.push(newCategory);
                saveData();
                
                // Clear input
                categoryInput.value = '';
                
                // Update UI
                updateCategoriesList();
                setupMealForm(); // Refresh ingredients form to include new category
            });
            
            // Initial display
            updateCategoriesList();
        }
        
        // Generate shopping list for the week
        function generateShoppingList() {
            const shoppingListContainer = document.getElementById('shopping-list-container');
            shoppingListContainer.innerHTML = '';
            
            // Collect all ingredients needed for the week
            const neededIngredients = [];
            
            for (const day in weeklyPlan) {
                if (weeklyPlan[day].type === 'meal' && weeklyPlan[day].mealId) {
                    const meal = meals.find(m => m.id == weeklyPlan[day].mealId);
                    if (meal && meal.ingredients) {
                        meal.ingredients.forEach(ingredient => {
                            // Check if ingredient already in list
                            const existingIng = neededIngredients.find(i => 
                                i.name.toLowerCase() === ingredient.name.toLowerCase() && 
                                i.categoryId == ingredient.categoryId);
                            
                            if (existingIng) {
                                existingIng.count += weeklyPlan[day].people; // Increment count based on people
                            } else {
                                // Add new ingredient to list
                                neededIngredients.push({
                                    ...ingredient,
                                    count: weeklyPlan[day].people,
                                    mealName: meal.name,
                                    day: day
                                });
                            }
                        });
                    }
                }
            }
            
            if (neededIngredients.length === 0) {
                shoppingListContainer.innerHTML = '<p>No ingredients needed for this week\'s plan.</p>';
                return;
            }
            
            // Group by category
            const groupedIngredients = {};
            
            categories.forEach(category => {
                groupedIngredients[category.id] = {
                    name: category.name,
                    ingredients: []
                };
            });
            
            neededIngredients.forEach(ingredient => {
                if (groupedIngredients[ingredient.categoryId]) {
                    groupedIngredients[ingredient.categoryId].ingredients.push(ingredient);
                } else {
                    // Handle case where category might have been deleted
                    if (!groupedIngredients['uncategorized']) {
                        groupedIngredients['uncategorized'] = {
                            name: 'Uncategorized',
                            ingredients: []
                        };
                    }
                    groupedIngredients['uncategorized'].ingredients.push(ingredient);
                }
            });
            
            // Create shopping list HTML
            for (const categoryId in groupedIngredients) {
                const category = groupedIngredients[categoryId];
                
                if (category.ingredients.length === 0) continue;
                
                const categoryGroup = document.createElement('div');
                categoryGroup.className = 'category-group';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = category.name;
                categoryGroup.appendChild(categoryTitle);
                
                const ingredientsList = document.createElement('ul');
                
                category.ingredients.forEach(ingredient => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${ingredient.name} (${ingredient.count > 1 ? `${ingredient.count}x: ` : ''}${ingredient.mealName})`;
                    ingredientsList.appendChild(listItem);
                });
                
                categoryGroup.appendChild(ingredientsList);
                shoppingListContainer.appendChild(categoryGroup);
            }
            
            // Setup print button
            const printBtn = document.getElementById('print-shopping-list');
            printBtn.addEventListener('click', () => {
                window.print();
            });
        }
        
        // Randomize weekly plan
        function setupRandomize() {
            const randomizeBtn = document.getElementById('randomize-btn');
            
            randomizeBtn.addEventListener('click', () => {
                if (meals.length === 0) {
                    alert('Please add some meals first before randomizing the plan');
                    return;
                }
                
                // Randomize each day that isn't set to "other"
                for (const day in weeklyPlan) {
                    if (weeklyPlan[day].type !== 'other') {
                        // Pick a random meal
                        const randomIndex = Math.floor(Math.random() * meals.length);
                        weeklyPlan[day] = { type: 'meal', mealId: meals[randomIndex].id, people: weeklyPlan[day].people };
                    }
                }
                
                saveData();
                generateWeekGrid();
                generateShoppingList();
            });
        }
        
        // Clear weekly plan
        function setupClearButton() {
            const clearBtn = document.getElementById('clear-week-btn');
            
            clearBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all meal selections for the week?')) {
                    // Reset all days to empty selection
                    for (const day in weeklyPlan) {
                        weeklyPlan[day] = { type: 'meal', mealId: null, people: weeklyPlan[day].people };
                    }
                    
                    saveData();
                    generateWeekGrid();
                    generateShoppingList();
                }
            });
        }
        
        // Generate meal grid (cards view)
        function generateMealGrid() {
            const mealsContainer = document.getElementById('meals-container');
            mealsContainer.innerHTML = '';
            mealsContainer.className = 'meal-grid';
            
            if (meals.length === 0) {
                mealsContainer.innerHTML = '<p>No meals added yet. Add your first meal above!</p>';
                return;
            }
            
            meals.forEach(meal => {
                const mealCard = document.createElement('div');
                mealCard.className = 'meal-card';
                mealCard.id = `meal-card-${meal.id}`;
                
                const mealName = document.createElement('h3');
                mealName.textContent = meal.name;
                mealCard.appendChild(mealName);
                
                if (meal.description) {
                    const mealDesc = document.createElement('p');
                    mealDesc.textContent = meal.description;
                    mealCard.appendChild(mealDesc);
                }
                
                if (meal.ingredients && meal.ingredients.length > 0) {
                    const ingredientsList = document.createElement('div');
                    ingredientsList.className = 'ingredients-list';
                    ingredientsList.innerHTML = '<strong>Ingredients:</strong><br>';
                    
                    const ingredientItems = document.createElement('ul');
                    meal.ingredients.forEach(ing => {
                        const category = categories.find(cat => cat.id == ing.categoryId);
                        const ingredientItem = document.createElement('li');
                        ingredientItem.textContent = `${ing.name} (${category ? category.name : 'Uncategorized'})`;
                        ingredientItems.appendChild(ingredientItem);
                    });
                    
                    ingredientsList.appendChild(ingredientItems);
                    mealCard.appendChild(ingredientsList);
                }
                
                const actionButtons = document.createElement('div');
                actionButtons.className = 'action-buttons';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.textContent = 'Edit';
                editBtn.addEventListener('click', () => {
                    editMeal(meal.id);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => {
                    deleteMeal(meal.id);
                });
                
                actionButtons.appendChild(editBtn);
                actionButtons.appendChild(deleteBtn);
                mealCard.appendChild(actionButtons);
                
                mealsContainer.appendChild(mealCard);
            });
        }
        
        // Edit meal functionality
        function editMeal(mealId) {
            const meal = meals.find(m => m.id == mealId);
            if (!meal) return;
            
            const mealCard = document.getElementById(`meal-card-${mealId}`);
            if (!mealCard) return;
            
            // Save original content to restore if cancelled
            const originalContent = mealCard.innerHTML;
            
            // Clear the card and create an edit form
            mealCard.innerHTML = '';
            
            // Name input
            const nameGroup = document.createElement('div');
            nameGroup.className = 'form-group';
            
            const nameLabel = document.createElement('label');
            nameLabel.textContent = 'Meal Name:';
            
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = meal.name;
            
            nameGroup.appendChild(nameLabel);
            nameGroup.appendChild(nameInput);
            mealCard.appendChild(nameGroup);
            
            // Description input
            const descGroup = document.createElement('div');
            descGroup.className = 'form-group';
            
            const descLabel = document.createElement('label');
            descLabel.textContent = 'Description:';
            
            const descInput = document.createElement('textarea');
            descInput.value = meal.description || '';
            
            descGroup.appendChild(descLabel);
            descGroup.appendChild(descInput);
            mealCard.appendChild(descGroup);
            
            // Ingredients section
            const ingredientsGroup = document.createElement('div');
            ingredientsGroup.className = 'form-group';
            
            const ingredientsLabel = document.createElement('label');
            ingredientsLabel.textContent = 'Ingredients:';
            
            const ingredientsContainer = document.createElement('div');
            ingredientsContainer.className = 'ingredients-container';
            
            // Add current ingredients
            if (meal.ingredients && meal.ingredients.length > 0) {
                meal.ingredients.forEach(ingredient => {
                    const row = document.createElement('div');
                    row.className = 'ingredient-row';
                    
                    const nameInput = document.createElement('input');
                    nameInput.type = 'text';
                    nameInput.className = 'ingredient-name';
                    nameInput.value = ingredient.name;
                    
                    const categorySelect = document.createElement('select');
                    categorySelect.className = 'ingredient-category';
                    
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        categorySelect.appendChild(option);
                    });
                    
                    categorySelect.value = ingredient.categoryId;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'delete-btn';
                    removeBtn.textContent = 'Remove';
                    removeBtn.addEventListener('click', () => {
                        row.remove();
                    });
                    
                    row.appendChild(nameInput);
                    row.appendChild(categorySelect);
                    row.appendChild(removeBtn);
                    
                    ingredientsContainer.appendChild(row);
                });
            } else {
                // Add an empty ingredient row
                const row = document.createElement('div');
                row.className = 'ingredient-row';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'ingredient-name';
                nameInput.placeholder = 'Ingredient name';
                
                const categorySelect = document.createElement('select');
                categorySelect.className = 'ingredient-category';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'delete-btn';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', () => {
                    row.remove();
                });
                
                row.appendChild(nameInput);
                row.appendChild(categorySelect);
                row.appendChild(removeBtn);
                
                ingredientsContainer.appendChild(row);
            }
            
            // Add ingredient button
            const addIngBtn = document.createElement('button');
            addIngBtn.className = 'add-ingredient-btn';
            addIngBtn.textContent = 'Add Ingredient';
            addIngBtn.addEventListener('click', () => {
                const row = document.createElement('div');
                row.className = 'ingredient-row';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'ingredient-name';
                nameInput.placeholder = 'Ingredient name';
                
                const categorySelect = document.createElement('select');
                categorySelect.className = 'ingredient-category';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'delete-btn';
                removeBtn.textContent = 'Remove';
                removeBtn.addEventListener('click', () => {
                    row.remove();
                });
                
                row.appendChild(nameInput);
                row.appendChild(categorySelect);
                row.appendChild(removeBtn);
                
                ingredientsContainer.appendChild(row);
            });
            
            ingredientsGroup.appendChild(ingredientsLabel);
            ingredientsGroup.appendChild(ingredientsContainer);
            ingredientsGroup.appendChild(addIngBtn);
            mealCard.appendChild(ingredientsGroup);
            
            // Action buttons
            const actionBtns = document.createElement('div');
            actionBtns.className = 'action-buttons';
            
            const saveBtn = document.createElement('button');
            saveBtn.className = 'save-btn';
            saveBtn.textContent = 'Save Changes';
            saveBtn.addEventListener('click', () => {
                // Validate
                if (!nameInput.value.trim()) {
                    alert('Please enter a meal name');
                    return;
                }
                
                // Collect ingredients
                const ingredients = [];
                const ingredientRows = ingredientsContainer.querySelectorAll('.ingredient-row');
                
                ingredientRows.forEach(row => {
                    const nameInput = row.querySelector('.ingredient-name');
                    const categorySelect = row.querySelector('.ingredient-category');
                    
                    if (nameInput.value.trim()) {
                        ingredients.push({
                            name: nameInput.value.trim(),
                            categoryId: categorySelect.value
                        });
                    }
                });
                
                // Update meal
                meal.name = nameInput.value.trim();
                meal.description = descInput.value.trim();
                meal.ingredients = ingredients;
                
                saveData();
                generateMealGrid();
                generateWeekGrid();
                generateShoppingList();
            });
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'cancel-btn';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.addEventListener('click', () => {
                mealCard.innerHTML = originalContent;
            });
            
            actionBtns.appendChild(saveBtn);
            actionBtns.appendChild(cancelBtn);
            mealCard.appendChild(actionBtns);
        }
        
        // Setup ingredients management
        function setupIngredientManagement() {
            const addIngredientBtn = document.getElementById('add-ingredient-btn-standalone');
            const ingredientName = document.getElementById('ingredient-name');
            const categorySelect = document.getElementById('ingredient-category-select');
            const unitSelect = document.getElementById('ingredient-default-unit');
            const ingredientsGrid = document.getElementById('ingredients-grid');
            const ingredientSearch = document.getElementById('ingredient-search');
            
            // Populate category dropdown
            function populateCategoryDropdown() {
                categorySelect.innerHTML = '';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
            }
            
            // Generate ingredients grid
            function generateIngredientsGrid(filterText = '') {
                ingredientsGrid.innerHTML = '';
                
                const filteredIngredients = filterText 
                    ? ingredients.filter(ing => ing.name.toLowerCase().includes(filterText.toLowerCase()))
                    : ingredients;
                
                if (filteredIngredients.length === 0) {
                    ingredientsGrid.innerHTML = '<p>No ingredients added yet. Add your first ingredient above!</p>';
                    return;
                }
                
                filteredIngredients.forEach(ingredient => {
                    const card = document.createElement('div');
                    card.className = 'ingredient-card';
                    card.id = `ingredient-${ingredient.id}`;
                    
                    const name = document.createElement('h4');
                    name.textContent = ingredient.name;
                    
                    const category = categories.find(cat => cat.id == ingredient.categoryId);
                    const categoryBadge = document.createElement('div');
                    categoryBadge.className = 'ingredient-category';
                    categoryBadge.textContent = category ? category.name : 'Uncategorized';
                    
                    const unitInfo = document.createElement('div');
                    unitInfo.className = 'ingredient-info';
                    unitInfo.textContent = `Default unit: ${ingredient.unit}`;
                    
                    const actionButtons = document.createElement('div');
                    actionButtons.className = 'action-buttons';
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'edit-btn';
                    editBtn.textContent = 'Edit';
                    editBtn.addEventListener('click', () => {
                        editIngredient(ingredient.id);
                    });
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.addEventListener('click', () => {
                        deleteIngredient(ingredient.id);
                    });
                    
                    actionButtons.appendChild(editBtn);
                    actionButtons.appendChild(deleteBtn);
                    
                    card.appendChild(name);
                    card.appendChild(categoryBadge);
                    card.appendChild(unitInfo);
                    card.appendChild(actionButtons);
                    
                    ingredientsGrid.appendChild(card);
                });
            }
            
            // Edit ingredient
            function editIngredient(id) {
                const ingredient = ingredients.find(ing => ing.id == id);
                if (!ingredient) return;
                
                const card = document.getElementById(`ingredient-${id}`);
                if (!card) return;
                
                // Save original content
                const originalContent = card.innerHTML;
                
                // Clear card and create edit form
                card.innerHTML = '';
                
                const nameGroup = document.createElement('div');
                nameGroup.className = 'form-group';
                
                const nameLabel = document.createElement('label');
                nameLabel.textContent = 'Name:';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = ingredient.name;
                
                nameGroup.appendChild(nameLabel);
                nameGroup.appendChild(nameInput);
                
                const categoryGroup = document.createElement('div');
                categoryGroup.className = 'form-group';
                
                const categoryLabel = document.createElement('label');
                categoryLabel.textContent = 'Category:';
                
                const categoryDropdown = document.createElement('select');
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categoryDropdown.appendChild(option);
                });
                categoryDropdown.value = ingredient.categoryId;
                
                categoryGroup.appendChild(categoryLabel);
                categoryGroup.appendChild(categoryDropdown);
                
                const unitGroup = document.createElement('div');
                unitGroup.className = 'form-group';
                
                const unitLabel = document.createElement('label');
                unitLabel.textContent = 'Default Unit:';
                
                const unitDropdown = document.createElement('select');
                const units = ['g', 'kg', 'ml', 'l', 'tsp', 'tbsp', 'cup', 'pcs', 'pinch', 'slice', 'clove', 'bunch', 'can', 'package', 'other'];
                units.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    unitDropdown.appendChild(option);
                });
                unitDropdown.value = ingredient.unit;
                
                unitGroup.appendChild(unitLabel);
                unitGroup.appendChild(unitDropdown);
                
                const actionButtons = document.createElement('div');
                actionButtons.className = 'action-buttons';
                
                const saveBtn = document.createElement('button');
                saveBtn.className = 'save-btn';
                saveBtn.textContent = 'Save';
                saveBtn.addEventListener('click', () => {
                    if (!nameInput.value.trim()) {
                        alert('Please enter an ingredient name');
                        return;
                    }
                    
                    ingredient.name = nameInput.value.trim();
                    ingredient.categoryId = categoryDropdown.value;
                    ingredient.unit = unitDropdown.value;
                    
                    saveData();
                    generateIngredientsGrid();
                });
                
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'cancel-btn';
                cancelBtn.textContent = 'Cancel';
                cancelBtn.addEventListener('click', () => {
                    card.innerHTML = originalContent;
                });
                
                actionButtons.appendChild(saveBtn);
                actionButtons.appendChild(cancelBtn);
                
                card.appendChild(nameGroup);
                card.appendChild(categoryGroup);
                card.appendChild(unitGroup);
                card.appendChild(actionButtons);
            }
            
            // Delete ingredient
            function deleteIngredient(id) {
                if (confirm('Are you sure you want to delete this ingredient?')) {
                    ingredients = ingredients.filter(ing => ing.id != id);
                    saveData();
                    generateIngredientsGrid();
                }
            }
            
            // Add ingredient button event
            addIngredientBtn.addEventListener('click', () => {
                if (!ingredientName.value.trim()) {
                    alert('Please enter an ingredient name');
                    return;
                }
                
                const newIngredient = {
                    id: Date.now().toString(),
                    name: ingredientName.value.trim(),
                    categoryId: categorySelect.value,
                    unit: unitSelect.value
                };
                
                ingredients.push(newIngredient);
                saveData();
                
                ingredientName.value = '';
                
                generateIngredientsGrid();
            });
            
            // Search event
            ingredientSearch.addEventListener('input', () => {
                generateIngredientsGrid(ingredientSearch.value);
            });
            
            // Initial setup
            populateCategoryDropdown();
            generateIngredientsGrid();
        }
        
        // Initialize app
        window.onload = function() {
            loadData();
            setupTabs();
            generateWeekGrid();
            // Replace the old list view with our new grid view
            generateMealGrid();
            setupMealForm();
            setupCategoryManagement();
            generateShoppingList();
            setupRandomize();
            setupClearButton();
            setupIngredientManagement();
        };
    </script>
</body>
</html>